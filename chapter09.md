# 9장 모듈

- 자바에선 패키지라 부르고, C# 에선 네임스페이스라 한다.

## 모듈로 설계하기

- DDD 컨텍스트에서 모듈은 서로 간에 높은 응집도를 갖고 있는 도메인 객체를 담는 이름이 붙여진 컨테이너 역할을 수행하며, 각기 다른 모듈에 있는 클래스 사이에 낮은 결합도를 유지하는 것이 목표가 돼야 한다.
- 모듈의 이름은 유비쿼터스 언어의 중요한 부분이다.
- 모듈 설계의 간단한 규칙
    - 모델링 개념에 맞춰 모듈을 설계하자.
    - 유비쿼터스 언어에 맞춰 모듈을 명명하자.
    - 모델에서 사용하는 일반적인 컴포넌트 타입이나 퍁턴에 따라서 기계적으로 모델을 생성하지 말자.
        - 도메인에 관해 열린 사고를 하지 못하고, 단순히 현재 문제를 풀기 위해 사용할 컴포넌트의 유형이나 패턴에 관해서만 생각하게 만든다.
    - 느슨하게 결합된 모듈을 설계하자
        - 모델링 개념을 유지 관리하고 리팩토링하는 일이 쉬워지며, 더 큰 규모의 모듈화 장치를 쉽게 사용하도록 해준다.
    - 결합이 필요하다면 짝이 되는 모듈 사이에서 비순환적 의존성이 형성되도록 노력하자.
        - 모듈이 상호 간에 완전히 독립적이기란 거의 불가능하며 실용적이지도 않기 때문에 도메인 모델이라는 자체가 어느 정도의 결합도를 내포한다.
        - 짝이 되는 두 모델 사이의 의존성을 단순히 단방향적으로 만든다면, 컴포넌트의 커플링을 줄일 수 있다.
    - 자식 모듈과 부모 모듈 사이에 규칙은 느슨하게 하자
        - 가능하다면 비순환적 의존성을 갖도록 노력해보고, 피할 방법이 없다면 순환적 의존성을 허용토록 하자. (예> 부모는 자식을 생성하고, 자식은 식별자를 통해서만 부모를 참조해야 한다.)
    - 모듈을 모델의 정적인 개념에 따라 만들지 말고, 모듈이 담고 있는 객체에 맞추도록 하자.
        - 모델의 개념이 시간의 흐름에 따라 변화하면서 여러 모습과 행동과 이름을 갖게 된다면, 이와 같은 개념을 담는 모듈 역시도 생성되거나 이름을 변겯ㅇ하거나 삭제돼야만 할 수 있다.
- 소프트웨어 모듈
    - 약한 결합을 형성하지만 논리적 응집도는 높은 소프트웨어 조각들을 버전에 따라 하나의 배포 단위로 패키징하는 방법
- DDD 모듈을 사용하는 방법에 집중한다면 모듈 설계에 도움이 된다.

## 기본 모듈 명명 규칙

- 자바와 C# 에서 모듈의 이름은 계층적 형태를 반영한다.
    - 일반적으로 이를 생성한 조직의 이름이 인터넷 도메인과 함께 조합돼 시작된다.
    - 고유한 최상위 수준 이름을 사용함으로써 프로젝트에서 사용하고 있는 써드파티 모듈과의 네임스페이스 충돌을 방지하고, 다른 이가 여러분의 모듈을 사용할 때 격을 수 있는 충돌을 막아준다.

## 모델을 위한 모듈 명명 규칙

- 모듈 이름에서 다음으로 이어지는 부분은 바운디드 컨텍스트를 나타낸다.
- 상업적 제품 이름을 모듈 이름에 사용하지 않는다.
    - 유비쿼터스 언어를 반영해 컨텍스트를 이름으로 식별하는편이 훨씬 중요하다.
```
com.saasovation.identityaccess.domain.model
com.saasovation.collaboration.domain.model
com.saasovation.agilepm.domain.model
```
- domain 에 해당하는 구획에는 인터페이스/클래스가 전혀 없고, 더 낮은 수준의 모듈을 위한 컨테이너 역할만을 수행한다.
- 한단계 더 내려가 model 이라는 모듈에서 클래스 정의가 시작된다. 이 모듈은 재사용 가능한 인터페이스와 추상 클래스를 포함할 수 있다.
```
com.saasovation.identityaccess.domain.service
com.saasovation.collaboration.domain.service
com.saasovation.agilepm.domain.service
```
- 도메인 서비스를 model 과 다른 모듈에 두기 원한다면 짝을 만들어 줄 수도 있다.
- 이런 접근법은 얼마 지나지 않아 애너믹 도메인 모델로 어이질 수 있다.

## 다른 계층 속의 모듈

- 도메인 모델을 다루는 애플리케이션에 사용되는 전형적인 계층적 아키텍처에선 `사용자 인터페이스`, `애플리케이션`, `도메인`, `인프라`와 같이 계층을 쌓게 되고, 애플리케이션의 필요에 맞춘 각 계층별 컴포넌트의 유형에 따라 각 계층에 속하는 모듈도 달라지게 된다.
- 사용자 인터페이스 계층
    - 레스트풀 리소스는 표현을 만들 때 프리젠테이션 레이아웃을 포함시켜선 안 된다.
    - 다양한 마크업과 직렬화 포멧으로 작성된 단순한 표현만을 만들어야 한다.
    - 레스트풀 리소스는 `resources` 패키지 안에서 유지 관리돼야 한다.
    - 표현에 관한 순수한 관심사는 하위 패키지인 `view`(`presentation`) 내의 컴포넌트로서 제공돼야 한다.
    - 실제 리소스 요구사항을 결정했다면, 좀 더 모듈화를 진행할지에 대한 판단은 쉽게 결정할 수 있는 문제가 된다.
- 애플리케이션 계층
    - 다른 모듈을 포함할 수 있으며, 이때는 각 모듈마다 하나의 서비스 타입을 다루도록 구성할 수 있다.
    - 애플리케이션 계층의 서비스는 도움이 될 경우에만 하위 모듈로 나눈다.
```
com.saasovation.agilepm.application.team
com.saasovation.agilepm.application.product
...
com.saasovation.agilepm.application.tenant
```

## 바운디드 컨텍스트보다 모듈

- 응집도 있는 도메인 모델 객체를 여러 모델로 나눌지, 하나로 유지할지 결정해야 할 때 신중해져야 한다.
    - 올바른 실제 도메인 언어가 확실하게 보이지 않고 애매한 경우나 컨텍스트적 경계를 만들지 여부가 분명치 않을 땐, 우선 이를 나누지 않고 하나로 유지하는 편을 고려하자.
- 모듈을 대신해 바운디드 컨텍스트를 사용할 수 없다.
- 응집도 높은 도메인 객체를 모듈화하고 응집력이 없거나 낮은 객체를 분리하기 위해 모듈을 사용하자.
