# 3장 컨텍스트 맵

## 컨텍스트 맵이 필수적인 이유

- 컨텍스트 맵은 상호 교류해야 하는 시스템의 목록을 제공할 뿐만 아니라, 팀 내부의 의사소통에서도 촉매 역할을 한다.
- 컨텍스트 맵을 그리면 의지하는 모든 다른 프로젝트들과의 관계를 신중히 생각해보도록 강요받는다.

### 컨텍스트 맵 그리기

- 현재를 매핑하고 프로젝트를 진행함에 따라 변경이 필요하다면 그 시점에서 맵을 업데이트 한다.
- 시각적인 컨텍스트 맵을 만드는 일은 복잡할 필요가 없다. (화이트보드)
- 다이어그램에 너무 많은 세부 내용을 추가하는 일은 팀에겐 전혀 실질적 도움을 주지 못한다.
- 대화를 통해 전략적 통찰이 드러나는 순간, 이를 컨텍스트 맵에 추가한다.
- 컨텍스트 맵은 조직 역학을 보여주기 때문에, 진행에 걸림돌이 되는 거버넌스 이슈나 다른 방법으론 밝혀내기 어려운 팀과 관리자의 여러 문제를 밝히는 데 도움이 될 수 있다.

### 프로젝트와 조직 관계

- 바운디드 컨텍스트와 개별적 프로젝트 팀 사이의 관계
- 파트너쉽
    - 두가지 컨텍스트 안의 팀이 성공이나 실패를 함께한다면 협업 관계
    - 개발과 통합의 공동 관리를 위한 잘 조정된 기획 과정을 도입
- 공유커널
    - 도메인 모델에서 팀이 공유하기로 동의한 부분집합
    - 이 명시적 공유는 특별한 상태에 놓이며, 다른팀과 상의없이 변경해선 안 된다.
- 고객-공급자 개발
    - 두 팀이 업스트림과 다운스트림의 관계에 있고, 업스트림 팀의 성공이 다운스트림 팀의 운명과 상호 의존적인 관계
    - 업스트림 계획이 다운스트림 우선순위에 영향을 미치기 때문에 업스트림 팁은 다양한 방법으로 다운스트림 팀의 요구를 수용해야 한다.
- 순응주의자
    - 업스트림 팀이 다운스트림 팀의 요구사항을 제공해줄 동기가 전혀 없는 고객-공급자 관계
    - 다운스트림 팀이 맹복적으로 업스트림 팁의 모델을 준수해서 바운디드 컨텍스트 사이에 나타나는 변환의 복잡성을 제거한다.
- 부패 방지 계층
    - 변환 계층은 협조적인 팀 사이에서 잘 설계된 바운디드 컨텍스트를 연결할때 간결하고 우아해질 수 있다.
    - 기존의 인터페이스를 통해 다른 시스템과 대화하며 다른 시스템은 수정할 필요가 거의 없거나 전혀 없다.
    - 필요에 따라 단방향이나 양방향으로 두 모델 사이에서 변환을 수행한다.
- 오픈 호스트 서비스
    - 서브시스템에 접근할 수 있도록 해주는, 서비스 집합으로서 프로토콜
    - 단일 팀의 특이한 요구가 있지 않는 이상, 이 프로토콜을 강화하고 확장해서 새로운 통합 요구사항에 대응
    - 단순함과 일관성을 유지하도록 한다.
- 발행된 언어
    - 둘 이상의 바운디드 컨텍스트 사이의 변환에 필요한 공유 언어
    - 종종 오픈 호스트 서비스와 결합된다.
- 분리된 방법
    - 두 기능성 집합 사이에 유의미한 관계가 없다면 이들은 완전히 분리돼야 한다.
- 큰 진흙공
    - 여러 모델이 서로 뒤섞이고 일정하지 않은 상황에서 시스템을 구성하는 상황 전체를 아우르는 경계
    - 이 컨텍스트 안에 세련된 모델링을 적용하려 애쓰지 말고 다른 컨텍스트 안으로 퍼져나가려는 경향에 주의한다.

### 세가지 컨텍스트를 매핑하기

- 각 바운디드 컨텍스트의 언어는 모든 모델이 순수하게 유지될 수 있도록 존중받아야 한다.
- 업스트림 모델은 다운스트임 모델에 영향을 준다.
- 업스트림 컨텍스트의 데이터 복제는 다운스트림 시스템이 바람직하지 않은 다양한 책임을 수행하도록 강제한다.
- 통합에 사용된 기술적 특성
    - 오픈 호스트 서비스
        - 바운디드 컨텍스트 클라이언트와 상호작용하는 REST 기반 리소스로 구현할 수 있다.
    - 발행된 언어
        - 다양한 표현 방법(XML, JSON, PB)을 사용할 수 있다.
        - 이벤트 주도 아키텍처에서도 사용할 수 있다.
    - 부패 방지 계층
        - 다운스트림 컨텍스트에 도메인 서비스를 정의하거나 레파지토리 인터페이스 뒤에 위치시킬 수 있다.
        - 다운스트림 부패방지 계층은 표현을 로컬 컨텍스트의 도메인 객체로 변환한다.

### 협업 컨텍스트

- 원격 호출은 성능을 떨어뜨리는 지연이나 전면적 실패가 발생할 잠재적 위험도가 높다.

### 애자일 프로젝트 관리 컨텍스트

- 업스트림 컨텍스트 의존성으로 부터 자율성을 달성하는 방법
    - 캐싱이 아닌 로컬 도메인 객체로 변환된 최소한의 상태만 로컬에 유지
    - 최초에는 RPC 나 유사한 요청을 통해 REST 기반 리소스를 가져와야 한다.
    - 원격 모델의 변경에 따른 동기화는 원격 시스템이 게시하는 메세지 지향 알림을 통해 가장 잘 이뤄질 수 있다.

### 식별자와 액세스 컨텍스트의 통합

- 바운디드 컨텍스트를 깔끔하게 분리함으로써, 각 바운디드 컨텍스트를 순수하게 유지하고 다른 컨텍스트의 데이터를 적용해 로컬 컨텍스트의 개념을 나타낼 수 있다.

### 협업 컨텍스트와 통합

- 도메인 이벤트와 이벤트 주도 아키텍처를 사용한 결과적 일관성을 활용해야 한다.
- 일관성을 위한 작업은 모델링해야 하는 또 하나의 유효한 상태일 뿐이다.
- 중요한 팀 의사소통으로 이어질 수 있는 관련된 높은 수준의 모든 요소를 포함시키고, 형식적으로 보이는 세부 내용은 밖으로 밀어내자.
