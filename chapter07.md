# 서비스

- 도메인 내에서 고유의 작업을 수행하는 무상태의 오퍼레이션
- 서비스 생성이 필요한 경우
    - 애그리게잇이나 값 객체상에서 수행해야 하는 오퍼레이션이 메소드로는 부적절하게 느껴질 때

## 도메인 서비스랑 무엇인가

- 애플리케이션 서비스는 도메인 모델의 클라이언트로서 보통 도메인 서비스의 클라이언트가 된다.
- 도메인 내의 유의미한 프로세스나 변형이 엔터티나 값 객체의 책임이 아닌 오퍼레이션 모델
- 오퍼레이션이 기존 엔티티나 값 객체에 속하지 않는 조건
    - 중요한 비지니스 프로세스를 수행할 때
    - 어떤 컴포지션에서 다른 컴포지션으로 도메인 객체를 변형할때
    - 하나 이상의 도메인 객체에서 필요로 하는 입력 값을 계산할 때
- 메소드를 단순히 하나의 엔터티나 값에 두기가 곤란할때 서비스를 정의
- 무상태이며 바운디드 컨텍스트의 유비쿼터스 언어를 확실히 표현하는 인터페이스를 가짐

## 서비스가 필요한지 확인하자

- 서비스를 지나치게 사용하면 애너믹 도메인 모델이 만들어지는 부정적인 결과를 초래할 수 있다.
    - 대부분의 도메인 로직이 엔터티와 값 객체 전체로 흩어지지 못하고 서비스에만 몰리게 됨
- 순수하게 도메인 특화된 지식은 클라이언트로 절대 유출돼선 안 된다.
    - 클라이언트가 애플리케이션 서비스라 해도, 해당 컴포넌트는 식별자와 액세스 관리 도메인의 책임을 져서는 안 된다.

## 도메인에서 서비스를 모델링하기

- 서비스와 분리된 인터페이스가 있어야만 하는지 판단이 필요하고, 있어야 한다면 애그리게잇과 같은 모듈에 선언된다.
- 인터페이스의 구현 클래스는 의존성 역행이나 헥사고날을 사용하고 있다면 도메인 모델 외부에 두고 싶을 수 있다.

### 분리된 인터페이스가 꼭 필요할까

- 기술적인 구현이 없는데도 분리된 인터페이스와 구현 클래스가 필요하고, 이를 분리된 계층과 모듈에 담아야 할 필요는 없다.(반드시 필요하진 않다.)
- 구현 클래스 이름 짓기
    - 자바 세계에서 구현 클래스의 이름을 지을 때 인터페이스 이름을 접두사로 하고 Impl 을 접미사로 하는 방식이 보편적이다.
    - 이런 식으로 명명된다면, 분리된 인터페이스가 필요없다는 표시거나 구현 클래스의 이름에 대해 좀 더 신중하게 생각해야 한다는 의미일 수 있다.
    - 여러 특정 구현을 제공하고 있기 때문에 구현 클래스의 결합을 분리하기로 목표를 세웠다면, 그 특수성에 맞게 클래스의 이름을 짓는다.
- 제어 역행 컨테이너는 서비스 인스턴스를 주입한다.
    - 클라이언트는 서비스를 인스턴스화하지 않기 때문에 인터페이스와 구현의 통합이나 분리에 관해 알지 못한다.

### 계산 프로세스

- 어플리케이션 서비스 내에 위치해선 안된다.

### 변환 서비스

- 인프라 내에 위치한 기술적 도메인 서비스의 다양한 구현은 주로 통합을 위해 사용된다.

### 도메인 서비스의 미니 계층 사용하기

- 종종 애너믹 도메인 모델로 이어지기 때문에 안티 패턴으로 간주해야 한다.
- 도메인 모델의 특징에 따라 도메인 서비스의 미니 계층을 설계하는 편이 좀 더 합리적이고, 애너믹 도메인 모델로 이어지지 않는 경우도 있다.
- 트랜잭션과 보안은 애플리케이션 서비스 내에서 애플리케이션의 문제로 다뤄야지, 도메인 서비스 내에서 다뤄선 안 된다.

## 서비스의 테스트

- 도메인에 초점을 맞춰 테스트를 진행하며, 이 시점에선 소프트웨어의 정확성을 자세히 살펴보는 일은 무시한다.
- 테스트 우선이 모델링의 초점을 올바르게 유지시키더라도, 절대적인 필수 요소는 아니다.
